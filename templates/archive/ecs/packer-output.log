==> amazon-ebs: Prevalidating AMI Name: ecs-ami-17
    amazon-ebs: Found Image ID: ami-5253c32d
==> amazon-ebs: Creating temporary keypair: packer_5b084896-ba8f-fa2b-aa24-6870dc341afa
==> amazon-ebs: Launching a source AWS instance...
==> amazon-ebs: Adding tags to source instance
    amazon-ebs: Adding tag: "tier": "ecs"
    amazon-ebs: Adding tag: "environment": "build"
    amazon-ebs: Adding tag: "role": "ami"
    amazon-ebs: Adding tag: "Name": "Packer Builder"
    amazon-ebs: Instance ID: i-0c063702d09b89407
==> amazon-ebs: Waiting for instance (i-0c063702d09b89407) to become ready...
==> amazon-ebs: Waiting for SSH to become available...
==> amazon-ebs: Connected to SSH!
==> amazon-ebs: Provisioning with shell script: build_ami.sh
    amazon-ebs: + mkdir /docker_scratch
    amazon-ebs: + mkdir -p /root/.docker
    amazon-ebs: + mkdir -p /root/.aws
    amazon-ebs: + yum -y update
    amazon-ebs: Loaded plugins: priorities, update-motd, upgrade-helper
    amazon-ebs: No packages marked for update
    amazon-ebs: + yum install -y python27-pip
    amazon-ebs: Loaded plugins: priorities, update-motd, upgrade-helper
    amazon-ebs: Resolving Dependencies
    amazon-ebs: --> Running transaction check
    amazon-ebs: ---> Package python27-pip.noarch 0:9.0.3-1.26.amzn1 will be installed
    amazon-ebs: --> Finished Dependency Resolution
    amazon-ebs:
    amazon-ebs: Dependencies Resolved
    amazon-ebs:
    amazon-ebs: ================================================================================
    amazon-ebs:  Package           Arch        Version                  Repository         Size
    amazon-ebs: ================================================================================
    amazon-ebs: Installing:
    amazon-ebs:  python27-pip      noarch      9.0.3-1.26.amzn1         amzn-updates      2.3 M
    amazon-ebs:
    amazon-ebs: Transaction Summary
    amazon-ebs: ================================================================================
    amazon-ebs: Install  1 Package
    amazon-ebs:
    amazon-ebs: Total download size: 2.3 M
    amazon-ebs: Installed size: 8.1 M
    amazon-ebs: Downloading packages:
    amazon-ebs: python27-pip-9.0.3-1.26.amzn1.noarch.rpm                   | 2.3 MB   00:01
    amazon-ebs: Running transaction check
    amazon-ebs: Running transaction test
    amazon-ebs: Transaction test succeeded
    amazon-ebs: Running transaction
    amazon-ebs:   Installing : python27-pip-9.0.3-1.26.amzn1.noarch                         1/1
    amazon-ebs:   Verifying  : python27-pip-9.0.3-1.26.amzn1.noarch                         1/1
    amazon-ebs:
    amazon-ebs: Installed:
    amazon-ebs:   python27-pip.noarch 0:9.0.3-1.26.amzn1
    amazon-ebs:
    amazon-ebs: Complete!
    amazon-ebs: + pip install awscli
    amazon-ebs: Collecting awscli
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/03/9d/a0b73320e4b9d776b0b68a67c7dbdc4115eb9eceff992d6b56222ba550d3/awscli-1.15.27-py2.py3-none-any.whl (1.3MB)
    amazon-ebs: [K    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1.3MB 985kB/s
    amazon-ebs: [?25hCollecting colorama<=0.3.9,>=0.2.5 (from awscli)
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/db/c8/7dcf9dbcb22429512708fe3a547f8b6101c0d02137acbd892505aee57adf/colorama-0.3.9-py2.py3-none-any.whl
    amazon-ebs: Collecting rsa<=3.5.0,>=3.1.2 (from awscli)
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/e1/ae/baedc9cb175552e95f3395c43055a6a5e125ae4d48a1d7a924baca83e92e/rsa-3.4.2-py2.py3-none-any.whl (46kB)
    amazon-ebs: [K    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 51kB 10.7MB/s
    amazon-ebs: [?25hRequirement already satisfied: PyYAML<=3.12,>=3.10 in /usr/lib64/python2.7/dist-packages (from awscli)
    amazon-ebs: Collecting botocore==1.10.27 (from awscli)
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/0a/fc/5dbeb052f4b70346ad3eb1ac291d503c0a28ed7e0f806f7337bbb73e3b76/botocore-1.10.27-py2.py3-none-any.whl (4.2MB)
    amazon-ebs: [K    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4.2MB 280kB/s
    amazon-ebs: [?25hCollecting s3transfer<0.2.0,>=0.1.12 (from awscli)
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/d7/14/2a0004d487464d120c9fb85313a75cd3d71a7506955be458eebfe19a6b1d/s3transfer-0.1.13-py2.py3-none-any.whl (59kB)
    amazon-ebs: [K    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 61kB 10.1MB/s
    amazon-ebs: [?25hCollecting docutils>=0.10 (from awscli)
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/50/09/c53398e0005b11f7ffb27b7aa720c617aba53be4fb4f4f3f06b9b5c60f28/docutils-0.14-py2-none-any.whl (543kB)
    amazon-ebs: [K    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 552kB 2.3MB/s
    amazon-ebs: [?25hCollecting pyasn1>=0.1.3 (from rsa<=3.5.0,>=3.1.2->awscli)
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/a0/70/2c27740f08e477499ce19eefe05dbcae6f19fdc49e9e82ce4768be0643b9/pyasn1-0.4.3-py2.py3-none-any.whl (72kB)
    amazon-ebs: [K    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 81kB 11.0MB/s
    amazon-ebs: [?25hCollecting python-dateutil<3.0.0,>=2.1; python_version >= "2.7" (from botocore==1.10.27->awscli)
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/cf/f5/af2b09c957ace60dcfac112b669c45c8c97e32f94aa8b56da4c6d1682825/python_dateutil-2.7.3-py2.py3-none-any.whl (211kB)
    amazon-ebs: [K    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 215kB 5.3MB/s
    amazon-ebs: [?25hCollecting jmespath<1.0.0,>=0.7.1 (from botocore==1.10.27->awscli)
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/b7/31/05c8d001f7f87f0f07289a5fc0fc3832e9a57f2dbd4d3b0fee70e0d51365/jmespath-0.9.3-py2.py3-none-any.whl
    amazon-ebs: Collecting futures<4.0.0,>=2.2.0; python_version == "2.6" or python_version == "2.7" (from s3transfer<0.2.0,>=0.1.12->awscli)
    amazon-ebs:   Downloading https://files.pythonhosted.org/packages/2d/99/b2c4e9d5a30f6471e410a146232b4118e697fa3ffc06d6a65efde84debd0/futures-3.2.0-py2-none-any.whl
    amazon-ebs: Requirement already satisfied: six>=1.5 in /usr/lib/python2.7/dist-packages (from python-dateutil<3.0.0,>=2.1; python_version >= "2.7"->botocore==1.10.27->awscli)
    amazon-ebs: Installing collected packages: colorama, pyasn1, rsa, python-dateutil, jmespath, docutils, botocore, futures, s3transfer, awscli
    amazon-ebs: Successfully installed awscli-1.15.27 botocore-1.10.27 colorama-0.3.9 docutils-0.14 futures-3.2.0 jmespath-0.9.3 pyasn1-0.4.3 python-dateutil-2.7.3 rsa-3.4.2 s3transfer-0.1.13
    amazon-ebs: [33mYou are using pip version 9.0.3, however version 10.0.1 is available.
    amazon-ebs: You should consider upgrading via the 'pip install --upgrade pip' command.[0m
    amazon-ebs: + install_puppet
    amazon-ebs: + OS_RELEASE=6
    amazon-ebs: + echo '**** Starting Puppet Install ****'
    amazon-ebs: **** Starting Puppet Install ****
    amazon-ebs: + rpm -Uvh https://yum.puppet.com/puppet5/puppet5-release-el-6.noarch.rpm
    amazon-ebs: Retrieving https://yum.puppet.com/puppet5/puppet5-release-el-6.noarch.rpm
    amazon-ebs: warning: /var/tmp/rpm-tmp.0cGmcP: Header V4 RSA/SHA512 Signature, key ID ef8d349f: NOKEY
    amazon-ebs: Preparing...                                                            (100%)#                                 (100%)##                                (100%)###                               (100%)####                              (100%)#####                             (100%)######                            (100%)#######                           (100%)########                          (100%)#########                         (100%)##########                        (100%)###########                       (100%)############                      (100%)#############                     (100%)##############                    (100%)###############                   (100%)################                  (100%)#################                 (100%)##################                (100%)###################               (100%)####################              (100%)#####################             (100%)######################            (100%)#######################           (100%)########################          (100%)#########################         (100%)##########################        (100%)###########################       (100%)############################      (100%)#############################     (100%)##############################    (100%)###############################   (100%)################################  (100%)################################# (100%)################################# [100%]
    amazon-ebs: Updating / installing...
    amazon-ebs:    1:puppet5-release-5.0.0-1.el6                                        ( 64%)#                                 ( 64%)##                                ( 64%)###                               ( 64%)####                              ( 64%)#####                             ( 64%)######                            ( 64%)#######                           ( 64%)########                          ( 64%)#########                         ( 64%)##########                        ( 64%)###########                       ( 64%)############                      ( 64%)#############                     ( 64%)##############                    ( 64%)###############                   ( 64%)################                  ( 64%)#################                 ( 64%)##################                ( 64%)###################               ( 64%)####################              ( 64%)#####################             ( 64%)######################            ( 83%)#######################           ( 83%)########################          ( 83%)#########################         ( 83%)##########################        ( 83%)###########################       ( 83%)############################      ( 88%)#############################     ( 88%)##############################    ( 96%)###############################   ( 96%)################################  (100%)################################# (100%)################################# [100%]
    amazon-ebs: + yum -y install puppet-agent
    amazon-ebs: Loaded plugins: priorities, update-motd, upgrade-helper
    amazon-ebs: puppet5                                                  | 2.5 kB     00:00
    amazon-ebs: puppet5/x86_64/primary_db                                  |  91 kB   00:00
    amazon-ebs: Resolving Dependencies
    amazon-ebs: --> Running transaction check
    amazon-ebs: ---> Package puppet-agent.x86_64 0:5.5.1-1.el6 will be installed
    amazon-ebs: --> Finished Dependency Resolution
    amazon-ebs:
    amazon-ebs: Dependencies Resolved
    amazon-ebs:
    amazon-ebs: ================================================================================
    amazon-ebs:  Package              Arch           Version              Repository       Size
    amazon-ebs: ================================================================================
    amazon-ebs: Installing:
    amazon-ebs:  puppet-agent         x86_64         5.5.1-1.el6          puppet5          21 M
    amazon-ebs:
    amazon-ebs: Transaction Summary
    amazon-ebs: ================================================================================
    amazon-ebs: Install  1 Package
    amazon-ebs:
    amazon-ebs: Total download size: 21 M
    amazon-ebs: Installed size: 21 M
    amazon-ebs: Downloading packages:
    amazon-ebs: warning: /var/cache/yum/x86_64/latest/puppet5/packages/puppet-agent-5.5.1-1.el6.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID ef8d349f: NOKEY
    amazon-ebs: Public key for puppet-agent-5.5.1-1.el6.x86_64.rpm is not installed
    amazon-ebs: puppet-agent-5.5.1-1.el6.x86_64.rpm                        |  21 MB   00:00
    amazon-ebs: Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-puppet5
    amazon-ebs: Importing GPG key 0xEF8D349F:
    amazon-ebs:  Userid     : "Puppet, Inc. Release Key (Puppet, Inc. Release Key) <release@puppet.com>"
    amazon-ebs:  Fingerprint: 6f6b 1550 9cf8 e59e 6e46 9f32 7f43 8280 ef8d 349f
    amazon-ebs:  Package    : puppet5-release-5.0.0-1.el6.noarch (installed)
    amazon-ebs:  From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-puppet5
    amazon-ebs: Running transaction check
    amazon-ebs: Running transaction test
    amazon-ebs: Transaction test succeeded
    amazon-ebs: Running transaction
    amazon-ebs: Warning: RPMDB altered outside of yum.
    amazon-ebs:   Installing : puppet-agent-5.5.1-1.el6.x86_64                              1/1
    amazon-ebs:   Verifying  : puppet-agent-5.5.1-1.el6.x86_64                              1/1
    amazon-ebs:
    amazon-ebs: Installed:
    amazon-ebs:   puppet-agent.x86_64 0:5.5.1-1.el6
    amazon-ebs:
    amazon-ebs: Complete!
    amazon-ebs: + /opt/puppetlabs/bin/puppet config set --section main server ops-pup-master-use1.blackfynn.io
    amazon-ebs: + /opt/puppetlabs/bin/puppet resource service puppet enable=true
    amazon-ebs: [mNotice: /Service[puppet]/enable: enable changed 'false' to 'true'[0m
    amazon-ebs: service { 'puppet':
    amazon-ebs:   enable => 'true',
    amazon-ebs: }
    amazon-ebs: + echo 'Creating AWS CLI config file.'
    amazon-ebs: Creating AWS CLI config file.
    amazon-ebs: + cat
    amazon-ebs: + echo 'Configuring Docker and ECS dameon.'
    amazon-ebs: Configuring Docker and ECS dameon.
    amazon-ebs: ++ /usr/local/bin/aws --output text ssm get-parameter --name ops-ci-docker-hub-url --query Parameter.Value
    amazon-ebs: + DOCKER_REGISTRY_URL=https://index.docker.io/v1/
    amazon-ebs: ++ /usr/local/bin/aws --output text ssm get-parameter --name ops-ci-docker-hub-auth --with-decryption --query Parameter.Value
    amazon-ebs: + DOCKER_REGISTRY_AUTH=YmxhY2tmeW5uY2k6Mm5rKXBiUmt4d0RxbWU3ZUNuTDYza3NScQ==
    amazon-ebs: ++ /usr/local/bin/aws --output text ssm get-parameter --name ops-ci-docker-hub-email --query Parameter.Value
    amazon-ebs: + DOCKER_REGISTRY_EMAIL=ci@blackfynn.com
    amazon-ebs: + cat
    amazon-ebs: + cat
    amazon-ebs: + chmod +x /opt/bf-ecs-cluster.sh
    amazon-ebs: + cat
    amazon-ebs: + echo 'Stoping ECS and cleaning up.'
    amazon-ebs: Stoping ECS and cleaning up.
    amazon-ebs: + rm -rf /var/lib/ecs/data/ecs_agent_data.json
==> amazon-ebs: Stopping the source instance...
    amazon-ebs: Stopping instance, attempt 1
==> amazon-ebs: Waiting for the instance to stop...
==> amazon-ebs: Creating the AMI: ecs-ami-17
    amazon-ebs: AMI: ami-0d4c2d72
==> amazon-ebs: Waiting for AMI to become ready...
==> amazon-ebs: Creating Encrypted AMI Copy
==> amazon-ebs: Copying AMI: us-east-1(ami-0d4c2d72)
==> amazon-ebs: Waiting for AMI copy to become ready...
==> amazon-ebs: Deregistering unencrypted AMI
==> amazon-ebs: Deleting unencrypted snapshots
    amazon-ebs: Deleting Snapshot ID: snap-038aa2206f4a532b5
    amazon-ebs: Deleting Snapshot ID: snap-05d439b9953d0f644
==> amazon-ebs: Adding tags to AMI (ami-66513019)...
==> amazon-ebs: Tagging snapshot: snap-0a7997c3ac7cf2a8b
==> amazon-ebs: Tagging snapshot: snap-0091823efea0a6a9e
==> amazon-ebs: Creating AMI tags
    amazon-ebs: Adding tag: "Name": "ecs-ami-17"
==> amazon-ebs: Creating snapshot tags
==> amazon-ebs: Terminating the source AWS instance...
==> amazon-ebs: Cleaning up any extra volumes...
==> amazon-ebs: No volumes to clean up, skipping
==> amazon-ebs: Deleting temporary keypair...
Build 'amazon-ebs' finished.

==> Builds finished. The artifacts of successful builds are:
--> amazon-ebs: AMIs were created:
us-east-1: ami-66513019

